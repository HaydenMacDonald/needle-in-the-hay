---
title: "Introducing squashinformr"
author: "Hayden MacDonald"
date: "2020-05-04"
output:
  blogdown::html_page:
    toc: false
slug: introducing-squashinformr
image_preview: "img/squashinformr_ghcard.png"
tags: 
- web-scraping
- R
- r-package
- data analysis
- squash
description: "Politely web scrape data from SquashInfo in R"
---

```{r, echo=FALSE, dpi=300, out.width="75%", out.height="75%", fig.align="center"}
knitr::include_graphics('/img/squashinformr_ghcard.png', error = FALSE)
```

Earlier this year, I enrolled in a Data Management course as a part of my MSc in Business Analytics. The final project in this course involved presenting a business case for a database and building a MySQL database as a solution. As a squash enthusiast, I chose to base my project on the <a href="https://psaworldtour.com/" target="_blank">Professional Squash Association (PSA)</a>.  

Long story short, I did not complete this project because it was cancelled due the spread of COVID-19. Unfortunately, I had already put in approximately 20 hours of coding into the project. So being as stubborn as I am, I committed to reusing the code by building an R package. The result is `squashinformr`: a package for scraping player, tournament, and ranking data from <a href="http://www.squashinfo.com/" target="_blank">SquashInfo</a>.  
&nbsp;  

## Politeness on the web
&nbsp;  
`squashinformr` is built on the <a href="https://github.com/dmi3kno/polite" target="_blank">`polite` package</a> and, therefore, inherits its principles of <a href="https://www.ddrive.no/post/be-nice-on-the-web/" target="_blank">"being nice on the web"</a>. In short, web scraping is a data collection method that can be harmful to websites and their users, if done carelessly. Therefore, it is important to use our manners:  

1. Seek permission to scrape before you begin.
2. Take slowly, so as to not be mistaken for a DDoS attack.
3. Never ask twice by using <a href="https://en.wikipedia.org/wiki/Memoization" target="_blank">memoization</a>.

Following `polite` principles incurs mandatory delays (set by SquashInfo's robots.txt file) on the scraping process. Therefore, it is important that users are patient when using `squashinformr`. SquashInfo currently offers full access to their data and extra features through a premium membership. Please consider <a href="http://www.squashinfo.com/signup" target="_blank">signing up and/or subscribing</a> to SquashInfo to support their work.  
&nbsp;  

## Installation
&nbsp;  
Install `squashinformr` via CRAN:  
&nbsp;  
```{r, eval=FALSE, message=FALSE, warning=FALSE}
install.packages("squashinformr")
```
&nbsp;  
Install the development version of `squashinformr` from its <a href="https://github.com/HaydenMacDonald/squashinformr" target="_blank">GitHub repository</a> via:  
&nbsp;  
```{r, eval=FALSE, message=FALSE, warning=FALSE}
if (!require("remotes")) install.packages("remotes")

remotes::install_github("HaydenMacDonald/squashinformr")
```
&nbsp;  

## Functions in v0.1.2
&nbsp;  
Generally, `squashinformr` functions fall into one of three families:  
&nbsp;  

- Player functions for scraping player profile data
  - `get_players()`
  - `get_player_recent_results()`
  - `get_player_recent_matches()`
  - `get_player_recent_games()`
  - `get_player_rankings_history()`
  - `get_matchup()`<br><br>
  

- Ranking functions for scraping current and historical rankings tables
  - `get_rankings()`
  - `get_historical_rankings()`<br><br>
  

- Tournament functions for scraping tournament results data
  - `get_tournaments()`
  - `get_tournament_players()`
  - `get_tournament_matches()`
  - `get_tournament_games()`<br><br>

Let's take a closer look at some of these functions in action...  
&nbsp;  

## Player functions
&nbsp;  
Use `get_players()` to extract biographical information on players currently ranked within the top 500. Here, we'll just scrape the current top 25 men's players.  
&nbsp;  
```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(patchwork)
library(ggbeeswarm)
library(gt)
library(janitor)
library(lubridate)
library(ggbump)
```

```{r, message=FALSE, warning=FALSE}
library(squashinformr)

(top_25_men <- get_players(top = 25, category = "mens"))
```
&nbsp;  
If you're familiar with squash, you might be under the impression that players that are younger, taller, or lighter on their feet might have competitive advantages.  
&nbsp;  
```{r, dev = 'CairoPNG', fig.width = 8, fig.height = 6, dpi = 300, echo = FALSE, warning=FALSE}
dark_red <- "#bb0011"
dark_orange <- "#d25d3c"
light_orange <- "#e39669"
tan <- "#eecc99"
light_grey <- "#cdcfd6"
light_purple <- "#95a1bd"
blue <- "#4477bb"

top_25_men %>%
  select(rank, age, height, weight) %>%
  mutate(bmi = weight / (height/100)^2) %>%
  pivot_longer(-rank, names_to = "variable", values_to = "value") %>%
  mutate(variable = str_to_title(variable),
         variable = case_when(variable == "Age" ~"Age (years)", 
                              variable == "Height" ~ "Height (cm)", 
                              variable == "Weight" ~ "Weight (kg)",
                              variable == "Bmi" ~ "BMI (kg/m^2)"),
         variable = factor(variable, levels = c("Age (years)", "Weight (kg)", "Height (cm)", "BMI (kg/m^2)"))) %>%
  ggplot(aes(x = rank, y = value, colour = rank)) +
    geom_boxplot(outlier.shape = NA) +
    geom_point(colour = dark_red, alpha = 0.5) +
    #geom_smooth(method = "lm", colour = dark_orange) +
    facet_wrap(~variable, nrow = 1) +
    scale_x_reverse() +
    scale_y_continuous(breaks = seq(0, 200, 25)) +
    theme_light() +
    labs(title = "Are certain physical attributes correlated with PSA rankings?",
         x = "\nRank", 
         y = "",
         colour = "Rank") +
    guides(colour = FALSE) +
    theme(strip.background = element_blank(),
          strip.text = element_text(colour = "black", size = 12),
          axis.text = element_text(size = 12),
          axis.title = element_text(size = 12))
```

The data returned from SquashInfo seem to imply that this is not the case! Age, height, weight, and BMI do not seem to have any clear relationship with PSA rankings. There are many factors that contribute to a player's success, including endurance, positioning, accuracy, and play-style.  
&nbsp;  

### Recent match data

Use `get_player_recent_matches()` to retrieve a player's recent match data (past January 1, 2019). Let's get Raneem El Welily's recent match data.  
&nbsp;  
```{r, message=FALSE, warning=FALSE}
(welily <- get_player_recent_matches(player = "Raneem El Welily", category = "womens"))
```
&nbsp;  
```{r, dev = 'CairoPNG', fig.width = 8, fig.height = 4.5, dpi = 300, echo = FALSE, warning=FALSE}
welily <- welily %>%
              mutate(result = factor(result, levels = c("W", "L")))


w1 <- welily %>%
        group_by(rank) %>%
        summarize(`Match Wins` = sum(if_else(result == "W", 1, 0), na.rm = TRUE),
                  `Match Losses` = sum(if_else(result == "L", 1, 0), na.rm = TRUE),
                  `Game Wins` = sum(games_won, na.rm = TRUE),
                  `Game Losses` = sum(games_lost, na.rm = TRUE)) %>%
        pivot_longer(-rank, names_to = "variable", values_to = "value") %>% 
        mutate(variable = factor(variable, levels = c("Game Losses", "Game Wins", "Match Losses", "Match Wins")),
               wl = factor(if_else(str_detect(variable, "Wins"), "W", "L"), levels = c("W", "L"))) %>%
        ggplot(aes(x = variable, y = value, colour = wl)) +
          geom_segment(aes(xend = variable, y = 0, yend = value), size = 1) +
          geom_point(size = 4, shape = 19) +
          geom_text(aes(label = value, colour = wl), nudge_y = 8) +
          scale_colour_manual(values = c(blue, dark_orange)) +
          coord_flip(ylim = c(0, 200)) +
          guides(colour = FALSE) +
          theme_light() +
          labs(title = "El Welily's win-loss record (matches and games)",
               x = "", 
               y = "") +
          theme(axis.text = element_text(size = 12),
                axis.title = element_text(size = 12))


w2 <- welily %>%
        group_by(rank) %>%
        summarize(`3-2 Wins` = sum(games_won == 3 & games_lost == 2, na.rm = TRUE),
                  `3-1 Wins` = sum(games_won == 3 & games_lost == 1, na.rm = TRUE),
                  `3-0 Wins` = sum(games_won == 3 & games_lost == 0, na.rm = TRUE),
                  `0-3 Losses` = sum(games_won == 0 & games_lost == 3, na.rm = TRUE),  ## Match spread variables relative to Welily
                  `1-3 Losses` = sum(games_won == 1 & games_lost == 3, na.rm = TRUE),
                  `2-3 Losses` = sum(games_won == 2 & games_lost == 3, na.rm = TRUE)) %>%
        pivot_longer(-rank, names_to = "variable", values_to = "value") %>% 
        mutate(variable = factor(variable, levels = c("2-3 Losses", "1-3 Losses", "0-3 Losses", "3-0 Wins", "3-1 Wins", "3-2 Wins")),
               wl = factor(if_else(str_detect(variable, "Wins"), "W", "L"), levels = c("W", "L"))) %>%
        ggplot(aes(x = variable, y = value, colour = wl)) +
          geom_segment(aes(xend = variable, y = 0, yend = value), size = 1) +
          geom_point(size = 4, shape = 19) +
          geom_text(aes(label = value), nudge_y = 8) +
          scale_colour_manual(values = c(blue, dark_orange)) +
          coord_flip(ylim = c(0, 200)) +
          guides(colour = FALSE) +
          theme_light() +
          labs(title = "Match spread statistics",
               x = "", 
               y = "Count\n") +
          theme(axis.text = element_text(size = 12),
                axis.title = element_text(size = 12))


w1 / w2
```

El Welily's 2019-2020 match data exemplify her general dominance of women's competitons. She has a 5.45 win/loss ratio across the tournaments she participated in and 65% of her match wins are 3-0s. Even when she does lose a match, she does not make it easy for her opponents. Her median match times in losses are longer regardless of the number of games played. Although, the sample size is low for El Welily's losses.  
&nbsp;  
```{r, dev = 'CairoPNG', fig.width = 8, fig.height = 8, dpi = 300, echo = FALSE, warning=FALSE}
welily %>%
    mutate(spread = case_when((games_won == 3 & games_lost == 2) | (games_won == 2 & games_lost == 3) ~ "3-2 Win or 2-3 Loss",
                              (games_won == 3 & games_lost == 1) | (games_won == 1 & games_lost == 3) ~ "3-1 Win or 1-3 Loss",
                              (games_won == 3 & games_lost == 0) | (games_won == 0 & games_lost == 3) ~ "3-0 Win or 0-3 Loss",
                              result == "W" ~ "Walkover",
                              result == "L" ~ "Retired")) %>%
    filter(spread != "Walkover", spread != "Retired") %>%
    ggplot(aes(x = rank, y = match_time, colour = result)) +
    geom_boxplot(outlier.shape = NA) +
    geom_beeswarm(dodge.width = 0.75, alpha = 0.5) +
    #geom_point(alpha = 0.5) +
    scale_colour_manual(values = c(blue, dark_orange)) +
    guides(colour = FALSE) +
    coord_cartesian(ylim = c(0, 80)) +
    facet_wrap(~spread) +
    theme_light() +
    labs(title = "Match time distributions",
         x = "", 
         y = "Match Time (minutes)\n",
         colour = "Result") +
    theme(strip.background = element_blank(),
          strip.text = element_text(colour = "black", size = 12),legend.position = c(0.5, 0.625),
          legend.title = element_text(size = 14),
          legend.text = element_text(size = 12),
          axis.text = element_text(size = 12),
          axis.text.x = element_blank(),
          axis.title = element_text(size = 12))
```

Given El Welily's general dominance, how does she play versus the current #2, Nouran Gohar? We can use `get_matchup()` to get a quantitative take on their head-to-head performance.  
&nbsp;  
```{r, message=FALSE, warning=FALSE, results='hide'}
welily_v_gohar <- get_matchup("Raneem El Welily", "Nouran Gohar", category = "womens")
```
&nbsp;  
```{r, dev = 'CairoPNG', fig.width = 8, fig.height = 4.5, dpi = 300, echo = FALSE, warning=FALSE}
welily_v_gohar %>%
  filter(metric != "player_1", metric != "player_2", str_detect(metric, "match")) %>%
  mutate(metric = str_replace_all(metric, pattern = "_", replacement = " "),
         metric = str_replace_all(metric, pattern = " (?=[0-9]+$)", replacement = "\\-"),
         metric = str_to_title(metric),
         value = as.numeric(value),
         metric = factor(metric, 
                         levels = c("Avg Match Time", "Matches 2-3", "Matches 1-3", "Matches 0-3", "Matches 3-0", "Matches 3-1", "Matches 3-2", 
                                    "Player 2 Matches Won", "Player 1 Matches Won", "Matches Played"),
                         labels = c("Avg Match Time", "2-3 Matches", "1-3 Matches", "0-3 Matches", "3-0 Matches", "3-1 Matches", "3-2 Matches", 
                                    "Player 2 Matches Won", "Player 1 Matches Won", "Matches Played"))) %>%
  ggplot(aes(x = metric, y = value)) +
    geom_segment(aes(xend = metric, y = 0, yend = value), size = 1, colour = tan) +
    geom_point(size = 4, shape = 21, fill = tan, colour = dark_red) +
    geom_text(aes(label = value), nudge_y = 2, colour = dark_red) +
    coord_flip(ylim = c(0, 50)) +
    #guides(colour = FALSE) +
    theme_light() +
    labs(title = "Raneem El Welily v Nouran Gohar",
         subtitle = "Head-to-Head Match Statistics; Match spread statistics relative to Raneem El Welily",
         x = "", 
         y = "") +
    theme(axis.text = element_text(size = 12),
          axis.title = element_text(size = 12))
```

El Welily's currently holds a lead on Gohar by five matches since Janary 1, 2019 and a majority of her wins over Gohar have been decisive (3-1 or 3-0).  
&nbsp;  
```{r, dev = 'CairoPNG', fig.width = 8, fig.height = 4.5, dpi = 300, echo = FALSE, warning=FALSE}
welily_v_gohar %>%
  filter(metric != "player_1", metric != "player_2", metric != "player_1_rank", metric != "player_2_rank", !str_detect(metric, "match")) %>%
  mutate(metric = str_replace_all(metric, pattern = "_", replacement = " "),
         metric = str_replace_all(metric, pattern = " (?=[0-9]+$)", replacement = "\\-"),
         metric = str_to_title(metric),
         value = as.numeric(value)) %>%
  clean_names(case = "title") %>%
  gt() %>%
    tab_header(title = "Raneem El Welily v Nouran Gohar",
               subtitle = glue::glue("Head-to-Head Game Statistics, 2019-2020")) %>%
    fmt_number(columns = "Value", drop_trailing_zeros = TRUE)
```
&nbsp;  
But, game-level data show that Gohar can be equally dominant in any individual game. Their approximately equal average point advantages reflects this. So it may be that El Welily's consistency across games that allows her to win more matches over Gohar.  
&nbsp;  

## Ranking functions
&nbsp;  
PSA Rankings are the definitive international ranking that decide which players are the best in the world. They have a huge influence on how tournament organizers seed individual players. Using `get_rankings()`, let's scrape the top 15 players from the most recent rankings tables (April 2020 at time of writing) for both competition categories.  
&nbsp;  
```{r, message=FALSE, warning=FALSE, results='hide'}
apr <- get_rankings(top = 15, category = "both")
```
&nbsp;  
```{r, echo=FALSE}
apr %>%
  filter(category == "Men's") %>%
  mutate(change = if_else(rank == previous_rank, NA_integer_, previous_rank - rank)) %>%
  select(rank, previous_rank, change, everything()) %>%
  clean_names(case = "title") %>%
  rename(`Highest Ranking Date` = `Hwr Date`) %>%
  gt() %>%
    opt_row_striping(row_striping = TRUE) %>%
    tab_header(title = "Men's PSA Rankings (April 2020)") %>%
    cols_hide(columns = "Category") %>%
    fmt_number(columns = c("Rank", "Previous Rank", "Change"), drop_trailing_zeros = TRUE) %>%
    data_color(columns = "Change", 
               colors = scales::col_numeric(palette = c("red", "#36b371") %>% as.character(), domain = c(-1, 2), reverse = FALSE), 
               apply_to = "text", autocolor_text = FALSE) %>%
    fmt_missing(columns = "Change")
```

&nbsp;  

```{r, echo=FALSE}
apr %>%
  filter(category == "Women's") %>%
  mutate(change = if_else(rank == previous_rank, NA_integer_, previous_rank - rank)) %>%
  select(rank, previous_rank, change, everything()) %>%
  clean_names(case = "title") %>%
  rename(`Highest Ranking Date` = `Hwr Date`) %>%
  gt() %>%
    opt_row_striping(row_striping = TRUE) %>%
    tab_header(title = "Women's PSA Rankings (April 2020)") %>%
    cols_hide(columns = "Category") %>%
    fmt_number(columns = c("Rank", "Previous Rank", "Change"), drop_trailing_zeros = TRUE) %>%
    data_color(columns = "Change", 
               colors = scales::col_numeric(palette = c("red", "#36b371") %>% as.character(), domain = c(-3, 3)), 
               apply_to = "text", autocolor_text = FALSE) %>%
    fmt_missing(columns = "Change")
```
&nbsp;  
`get_rankings()` is useful for analyzing how player rankings have changed recently. Alternatively, we can look back on an individual player's ranking history with `get_player_rankings_history()`.  
&nbsp;  

```{r, message=FALSE, warning=FALSE, results='hide'}
ph <- get_player_rankings_history(rank = 1:4, category = "womens")
```
&nbsp;  
```{r, dev = 'CairoPNG', fig.width = 8, fig.height = 8, dpi = 300, echo = FALSE, warning=FALSE}
ph %>%
  mutate(name = paste(name, " (Rank ", current_rank, ")", sep = ""),
         name = factor(name, levels = c("Raneem El Welily (Rank 1)", "Nouran Gohar (Rank 2)", "Nour El Sherbini (Rank 3)", "Camille Serme (Rank 4)"))) %>%
  ggplot() +
   geom_line(aes(x = exact_date, y = rank, group = name, colour = name)) +
   geom_hline(aes(yintercept = 20), linetype = "dashed") +
   geom_text(aes(x = ymd('2003-01-01'), y = 15, label = "Top 20")) +
   scale_colour_manual(values = c(dark_orange, light_purple, light_orange, blue)) +
   scale_y_reverse() +
   theme_light() +
   labs(title = "Player ranking histories for the current top 4 women's players",
        x = "\nDate", 
        y = "Rank\n", 
        colour = "Player") +
   theme(plot.subtitle = element_text(size = 10),
         axis.text.y = element_text(size = 12),
         axis.text.x = element_text(size = 12),
         axis.title = element_text(size = 12),
         legend.position = c(0.80, 0.75),
         legend.text = element_text(size = 10),
         legend.title = element_text(size = 12))
```
&nbsp;  
This is excellent data to use when discussing the story-lines of the sport. In this example, the current top 4 women's players all began their careers before 2012.  Since the end of 2014, they have occupied the top 20 rankings. We can see that Nouran Gohar had a meteoric rise through the rankings after her first PSA ranking in January 2011. The following graphic shows the last year of these players' ranking histories.  
&nbsp;  

```{r, dev = 'CairoPNG', fig.width = 8, fig.height = 4, dpi = 300, echo = FALSE, warning=FALSE, fig.cap="Shoutout to the ggbump package!"}
df <- ph %>%
        filter(exact_date > ymd("2019-03-01") & exact_date < ymd("2020-05-01")) %>%
        mutate(name = factor(name, levels = c("Raneem El Welily", "Nouran Gohar", "Nour El Sherbini", "Camille Serme"), labels = c("El Welily", "Gohar", "El Sherbini", "Serme")))

ggplot(df, aes(x = exact_date, y = rank, colour = name)) +
    geom_bump(size = 1, smooth = 8) + 
    geom_point(size = 4) +
    geom_text(data = df %>% filter(exact_date == ymd("2019-04-01")),
              aes(x = exact_date - 15, label = name), size = 5, hjust = 1) +
    geom_text(data = df %>% filter(exact_date == ymd("2020-04-01")),
              aes(x = exact_date + 15, label = name), size = 5, hjust = 0) +
    scale_colour_manual(values = c(dark_orange, light_purple, light_orange, blue)) +
    scale_y_reverse(breaks = seq(1, 7, 1)) + 
    coord_cartesian(xlim = c(ymd("2019-02-01"), ymd("2020-06-01"))) +
    theme_minimal() +
    theme(legend.position = "none",
          panel.grid.major = element_blank()) +
    labs(title = "Player ranking histories for the current top 4 women's players",
         subtitle = "April 2019 to April 2020",
         x = NULL, 
         y = "Rank\n") +
    guides(colour = FALSE) +
    theme(panel.grid.major = element_line(size = 0.5, colour = "grey92"),
          plot.subtitle = element_text(size = 10),
          axis.text.y = element_text(size = 12),
          axis.text.x = element_text(size = 12),
          axis.title = element_text(size = 12))
```

How will these rankings shift over the next couple of years?  
&nbsp;  

## Tournament functions
&nbsp;  
`squashinformr` provides useful functions for pulling tournament data at many levels of detail. This includes tournament metadata, players, matches, and games.  

The lowest level of detail is the tournament games, accessed via `get_tournament_games()`. Let's use this function to look at the JP Morgan Tournament of Champions, one of the premier tournaments in squash.  
&nbsp;  
```{r, message=FALSE, warning=FALSE}
## Return game data for 2020's Tournament of Champions.
(toc <- get_tournament_games("tournament of champions", year = 2020))
```
&nbsp;  
Let's compare the consistency of a player's performance in the men's tournament. We can ask, by what point margin did players win or lose on average throughout this tournament?  

```{r, dev = 'CairoPNG', fig.width = 8, fig.height = 9.5, dpi = 300, echo = FALSE, warning=FALSE}
toc_stats <- toc %>%
                filter(is.na(game_winner) == FALSE) %>%
                mutate(game_loser = if_else(player_1 == game_winner, player_2, player_1)) %>%
                pivot_longer(-c(tournament_name, category, tournament_date, round, match, 
                                game, game_winner, game_loser, player_1_score, player_2_score, 
                                player_1_seed, player_2_seed, player_1_nationality, player_2_nationality),
                             names_to = "player_no", values_to = "name") %>%
                group_by(category, name) %>%
                mutate(win_loss = if_else(game_winner == name, "W", "L"),
                       round_reached = max(round, na.rm = TRUE)) %>%
                group_by(category, name, win_loss) %>%
                summarize(round_reached = max(round, na.rm = TRUE),
                          count = n(),
                          avg_diff = mean(case_when(player_no == "player_1" ~ player_1_score - player_2_score,
                                                    player_no == "player_2" ~ player_2_score - player_1_score), na.rm = TRUE),
                          sd_diff = sd(case_when(player_no == "player_1" ~ player_1_score - player_2_score,
                                                  player_no == "player_2" ~ player_2_score - player_1_score), na.rm = TRUE))

toc_men <- toc_stats %>%
                filter(category == "Men's") %>%
                group_by(name) %>%
                mutate(wl_diff = max(avg_diff, na.rm = TRUE) - min(avg_diff, na.rm = TRUE),
                       no_wins = if_else("W" %in% win_loss, "Wins", "No wins"),
                       games = sum(count, na.rm = TRUE),
                       round_reached = max(round_reached, na.rm = TRUE)) %>%
                arrange(no_wins, wl_diff)

toc_men %>%
  mutate(nudge = if_else(win_loss == "W", round(avg_diff + 0.8, 2), round(avg_diff - 0.8, 2))) %>%
  ggplot(aes(x = fct_reorder(name, games, .fun = max), y = avg_diff)) + 
    geom_segment(aes(xend = name, y = 0, yend = avg_diff), size = 1, colour = light_purple) +
    geom_point(aes(colour = win_loss, size = count), shape = 19) +
    geom_text(aes(y = nudge, colour = win_loss, label = round(avg_diff, 2)), size = 3) +
    geom_hline(yintercept = 0, linetype = "dashed") +
    scale_colour_manual(values = c(dark_orange, blue)) +
    coord_flip(ylim = c(-10, 10)) +
    #gghighlight(round_reached >= "QF", use_direct_label = FALSE, max_highlight = 16) +
    #geom_text(aes(label = value), nudge_y = 2, colour = dark_orange) +
    guides(size = FALSE, colour = FALSE) +
    theme_light() +
    labs(title = "Average point advantage/disadvantage in game wins/losses",
         subtitle = "Point size increases with sample size of games won/lost; Players sorted by total games played",
         x = "", 
         y = "\nAverage Point Advantage / Disadvantage") +
    theme(plot.subtitle = element_text(size = 10),
          axis.text.y = element_text(size = 8),
          axis.text.x = element_text(size = 12),
          axis.title = element_text(size = 12))
```


If we only look at the quarter-finalists, we can see that most were able to defeat their opponents with a comfortable lead of 4 or 5 points.  

```{r, dev = 'CairoPNG', fig.width = 8, fig.height = 8, dpi = 300, echo = FALSE, warning=FALSE}
toc_men %>%
  group_by(name) %>%
  filter(max(round_reached) >= "QF") %>%
  ggplot(aes(x = fct_reorder(name, games, .fun = max), y = avg_diff)) + 
    geom_segment(aes(xend = name, y = 0, yend = avg_diff), size = 1, colour = light_purple) +
    geom_point(aes(colour = win_loss, size = count), shape = 19) +
    geom_errorbar(aes(colour = win_loss, ymin = avg_diff - sd_diff, ymax = avg_diff + sd_diff), size = 1, width = 0.2) +
    geom_text(aes(colour = win_loss, label = round(avg_diff, 2)), size = 6, nudge_x = -0.25) +
    geom_hline(yintercept = 0, linetype = "dashed") +
    scale_colour_manual(values = c(dark_orange, blue)) +
    coord_flip(ylim = c(-10, 10)) +
    guides(size = FALSE, colour = FALSE) +
    theme_light() +
    labs(title = "Average point advantage/disadvantage in game wins/losses",
         subtitle = "Point size increases with sample size of games won/lost; Error bars are one standard deviation",
         x = "", 
         y = "\nAverage Point Advantage / Disadvantage") +
    theme(plot.subtitle = element_text(size = 10),
          axis.text.y = element_text(size = 10),
          axis.text.x = element_text(size = 12),
          axis.title = element_text(size = 12))
```

The averages for Karim Abdel Gawad, Simon Rösner, and Paul Coll are particularly high. This reflects how they handedly defeated many of their opponents up to the third round of the tournament.  

Conversely, two players stand out from a "defensive" perspective. Simon Rösner only lost 3 games, all by a 2 or 3 point margin, during a game 5 defeat to Karim Abdel Gawad. Meanwhile, Mohamed Elshorbagy, the eventual champion, lost only one game. Tarek Momen took a game off of Elshorbagy in the final match, but only by a margin of 2 points. Elshorbagy certainly came to play in this tournament!  
&nbsp;  

## Conclusion
&nbsp;  
In this post, I've shown only a small selection of the functions provided in `squashinformr`. Install the package and try it out yourself! There is a huge amount of data on this excellent sport that has yet to be explored. Cheers!

The full code for this post is available <a href="https://github.com/HaydenMacDonald/needle-in-the-hay/blob/master/content/post/2020-04-15-introducing-squashinformr-politely-web-scrape-data-from-squashinfo-in-r.Rmd" target="_blank">here</a>.  
&nbsp;  
  
## Help
&nbsp;  
If you find a bug, please submit an issue on <a href="https://github.com/HaydenMacDonald/squashinformr" target="_blank">GitHub</a>.  
  
If you are interested in helping me extend the functionality of this package, fork the repository, make changes, and submit them as a pull request. The `squashinformr` project is released with a <a href="https://github.com/HaydenMacDonald/squashinformr/blob/master/.github/CODE_OF_CONDUCT.md" target="_blank">Contributor Code of Conduct</a>. By contributing to this project, you agree to its terms.  
&nbsp;  
  
## Disclaimer
&nbsp;  
SquashInfo is a valuable resource for the international squash community. By creating and sharing this package, I do not intend to compete with SquashInfo or any of its stakeholders. The `squashinformr` package was created to allow individuals to access data from SquashInfo in an efficient and responsible way, using <a href="https://github.com/dmi3kno/polite" target="_blank">`polite` principles</a>. SquashInfo currently offers full access to their data and extra features through a premium membership. Please consider <a href="http://www.squashinfo.com/upgrade" target="_blank">signing up and subscribing</a> to SquashInfo to support their work.  
&nbsp;  
  
## License
The `squashinformr` package is released under a <a href="https://github.com/HaydenMacDonald/squashinformr/blob/master/LICENSE.md" target="_blank">GPL-3</a> license.
&nbsp;  
