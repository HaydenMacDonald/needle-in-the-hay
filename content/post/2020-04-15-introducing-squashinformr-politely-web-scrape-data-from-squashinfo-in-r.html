---
title: "Introducing squashinformr: Politely web scrape data from SquashInfo in R"
author: "Hayden MacDonald"
date: "2020-04-15"
output:
  blogdown::html_page:
    toc: false
slug: introducing-squashinformr
image_preview: "img/squashinformr_ghcard.png"
tags: 
- web-scraping
- R
- r-package
- data-analysis
---



<div id="a-project-salvaged" class="section level2">
<h2>A Project Salvaged <img src="/img/sticker.png" width="129" height="150" align="right" /></h2>
<p> <br />
Earlier this year, I enrolled in a Data Management course as a part of my MSc in Business Analytics. The final project in this course involved writing a business case study, designing a database model, and building a MySQL database. As a squash enthusiast, I chose to base my project on the Professional Squash Association (PSA). The business case was that if the PSA invested in a database, they could enrich the viewing experience for PSA TV subscribers.</p>
<p>Long story short, I did not complete this project because it was cancelled due the spread of COVID-19.</p>
<p>Unfortunately, I had already put in approximately 20 hours of work into the project. Most of this work was a collection of R code used to scrape real data on PSA tournaments. So being as stubborn as I am, I committed to reusing the code by building an R package. The result is <code>squashinformr</code>: a package for scraping player, tournament, and ranking data from <a href="http://www.squashinfo.com/" target="_blank">SquashInfo</a>.<br />
 </p>
</div>
<div id="politeness-on-the-web" class="section level2">
<h2>Politeness on the web</h2>
<p> <br />
<code>squashinformr</code> is built on the <a href="https://github.com/dmi3kno/polite" target="_blank"><code>polite</code> package</a> and, therefore, inherits its principles on <a href="https://www.ddrive.no/post/be-nice-on-the-web/" target="_blank">“being nice on the web”</a>. In short, web scraping is a data collection method that can be harmful to websites and their users, if done carelessly. Therefore, it is important to use manners:</p>
<ol style="list-style-type: decimal">
<li>Seek permission to scrape before you begin.</li>
<li>Take slowly, so as to not be mistaken for a DDoS attack.</li>
<li>Never ask twice by using <a href="https://en.wikipedia.org/wiki/Memoization" target="_blank">memoization</a>.</li>
</ol>
<p><code>squashinformr</code> abides by these principles to avoid causing harm to SquashInfo and its users. Following <code>polite</code> principles incurs mandatory delays (set by SquashInfo’s robotstxt files) on the scraping process. Therefore, it is important that users are patient when using <code>squashinformr</code>. SquashInfo currently offers full access to their data and extra features through a premium membership. Please consider <a href="http://www.squashinfo.com/signup" target="_blank">signing up and/or subscribing</a> to SquashInfo to support their work.<br />
 </p>
</div>
<div id="functions-in-v0.1.0" class="section level2">
<h2>Functions in v0.1.0</h2>
<p> <br />
Generally, <code>squashinformr</code> functions fall into one of three families:<br />
 </p>
<ul>
<li>Player functions for scraping player profile data
<ul>
<li>get_players()</li>
<li>get_player_recent_results()</li>
<li>get_player_recent_matches()</li>
<li>get_player_recent_games()</li>
<li>get_player_rankings_history()</li>
<li>get_matchup()</li>
</ul></li>
<li>Tournament functions for scraping tournament results data
<ul>
<li>get_tournaments()</li>
<li>get_tournament_players()</li>
<li>get_tournament_matches()</li>
<li>get_tournament_games()</li>
</ul></li>
<li>Ranking functions for scraping current and historical rankings tables
<ul>
<li>get_rankings()</li>
<li>get_historical_rankings()</li>
</ul></li>
</ul>
<p> <br />
Let’s take a closer look at these functions in action…
 </p>
</div>
<div id="players" class="section level2">
<h2>Players</h2>
<p>Use <code>get_players()</code> to extract biographical information on players currently ranked within the top 500.</p>
<pre class="r"><code>library(squashinformr)
library(tidyverse)

(top_50_men &lt;- get_players(top = 50, category = &quot;mens&quot;))</code></pre>
<pre><code>## # A tibble: 50 x 15
##     rank first last    age gender birthplace nationality residence height weight
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;
##  1     1 Moha~ Elsh~    29 Male   Alexandria Egypt       Bristol,~    185     82
##  2     2 Ali   Farag    27 Male   Cairo      Egypt       Cairo        183     70
##  3     3 Karim Abde~    28 Male   Alexandria Egypt       Giza         173     72
##  4     4 Tarek Momen    32 Male   Cairo      Egypt       Cairo        174     66
##  5     5 Paul  Coll     27 Male   Greymouth  New Zealand Amsterda~    179     83
##  6     6 Diego Elias    23 Male   Lima       Peru        Lima         188     82
##  7     7 Marw~ Elsh~    26 Male   Alexandria Egypt       Bristol,~    183     73
##  8     8 Simon Rösn~    32 Male   Wurzburg   Germany     Paderborn    190     89
##  9     9 Migu~ Rodr~    34 Male   Bogota     Colombia    Bogota       170     72
## 10    10 Joel  Makin    25 Male   Haverford~ Wales       Birmingh~    180     80
## # ... with 40 more rows, and 5 more variables: plays &lt;chr&gt;, racket &lt;chr&gt;,
## #   joined_psa &lt;dbl&gt;, university &lt;chr&gt;, club &lt;chr&gt;</code></pre>
<p>If you’re familiar with squash, you might be under the impression that players that are younger, taller, or lighter on their feet might have competitive advantages.</p>
<p><img src="/post/2020-04-15-introducing-squashinformr-politely-web-scrape-data-from-squashinfo-in-r_files/figure-html/unnamed-chunk-3-1.png" width="2100" /></p>
<p>The data returned from SquashInfo seem to imply that this is not the case! Age, height, weight, and BMI all seem to be uncorrelated with PSA rankings. Squash is a game of endurance, positioning, accuracy, and strategic choice.</p>
</div>
<div id="get_recent_matches---get_matchup" class="section level2">
<h2>get_recent_matches -&gt; get_matchup()</h2>
<p>Use <code>get_player_recent_matches()</code> to retrieve a player’s recent match data (past January 1, 2019)</p>
<pre class="r"><code>(welily &lt;- get_player_recent_matches(player = &quot;Raneem El Welily&quot;, category = &quot;womens&quot;))</code></pre>
<pre><code>## Scraping http://www.squashinfo.com/rankings/women/1</code></pre>
<pre><code>## Scraping Raneem El Welily&#39;s profile</code></pre>
<pre><code>## # A tibble: 71 x 12
##     rank player opponent result games_won games_lost match_time round date      
##    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;date&gt;    
##  1     1 Ranee~ Nour El~ L              2          3         72 QF    2020-03-01
##  2     1 Ranee~ Yathreb~ W             NA         NA         NA R3    2020-03-01
##  3     1 Ranee~ Alexand~ W              3          1         36 R2    2020-03-01
##  4     1 Ranee~ Nour El~ L              2          3         59 F     2020-03-01
##  5     1 Ranee~ Nouran ~ W              3          0         31 SF    2020-03-01
##  6     1 Ranee~ Olivia ~ W              3          0         29 QF    2020-03-01
##  7     1 Ranee~ Salma H~ W              3          0         22 R3    2020-03-01
##  8     1 Ranee~ Juliann~ W              3          0         26 R2    2020-03-01
##  9     1 Ranee~ Nouran ~ W              1          0         15 F     2020-02-01
## 10     1 Ranee~ Hania E~ W              3          0         40 SF    2020-02-01
## # ... with 61 more rows, and 3 more variables: event &lt;chr&gt;, country &lt;chr&gt;,
## #   psa &lt;chr&gt;</code></pre>
<p><img src="/post/2020-04-15-introducing-squashinformr-politely-web-scrape-data-from-squashinfo-in-r_files/figure-html/unnamed-chunk-5-1.png" width="2100" /></p>
</div>
<div id="tournaments" class="section level2">
<h2>Tournaments</h2>
</div>
<div id="rankings" class="section level2">
<h2>Rankings</h2>
</div>
